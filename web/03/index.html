<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>走过路过不要错过</title>
		<link type='text/css' rel='stylesheet' href='format.css'>
		<link type='text/css' rel='stylesheet' href='../back.css'>
		<style>
			#op{
				margin: 0 270px;
				width: 200px;
			}
		</style>
		<script type='text/javascript'>
			/*获取真实返回路径*/
			function getPath(id) {
				var imgURL = "";
				var node=document.getElementById(id);
				try{
					var file = null;
					if(node.files && node.files[0] ){
						file = node.files[0];
					}else if(node.files && node.files.item(0)) {
						file = node.files.item(0);
					}
					//Firefox 因安全性问题已无法直接通过input[file].value 获取完整的文件路径
					try{
						//Firefox7.0
						imgURL =  file.getAsDataURL();
						//alert("//Firefox7.0"+imgRUL);
					}catch(e){
						//Firefox8.0以上
						imgURL = window.URL.createObjectURL(file);
						//alert("//Firefox8.0以上"+imgRUL);
					}
				}catch(e){      //这里不知道怎么处理了，如果是遨游的话会报这个异常
					//支持html5的浏览器,比如高版本的firefox、chrome、ie10
					if (node.files && node.files[0]) {
						var reader = new FileReader();
						reader.onload = function (e) {
							imgURL = e.target.result;
						};
						reader.readAsDataURL(node.files[0]);
					}
				}
				return imgURL;
			}
			
			//删除行
			function deleteRow(deleteButton){
				var currentIndex = deleteButton.parentNode.parentNode.rowIndex;
				var TVtable = document.getElementById('TVlist');
				TVtable.deleteRow(currentIndex);
			}
			//在Index位置添加行，默认添加在首个数据行
			function appendRow(index){
				var tvtable = document.getElementById('TVlist');
				//添加的位置索引
				var row = tvtable.insertRow(index);

				var tvpicture = row.insertCell(0);//必须从0开始，不然会没法显示
				var tvname = row.insertCell(1);
				var tvtype = row.insertCell(2);
				var tvguider = row.insertCell(3);
				var tvplayers = row.insertCell(4);
				var tvstory = row.insertCell(5);
				var editcell = row.insertCell(6);
				var deletecell = row.insertCell(7);

				var path = getPath('fileUpload');
				console.log(path);
				tvpicture.innerHTML='<img src="'+path+'">';
				// 由于浏览器的安全机制，input file的路径时被fakepath代替，隐藏了真实物理路径。

				tvname.innerHTML=document.getElementById('name').value;
				tvtype.innerHTML=document.getElementById('type').value;
				tvguider.innerHTML=document.getElementById('guider').value;
				tvplayers.innerHTML=document.getElementById('players').value;
				tvstory.innerHTML=document.getElementById('story').value;
				editcell.innerHTML = "<td><button value='TVedit' onclick='edit(this);'><a href='#TVedit'>编辑</a></button></td>";
				deletecell.innerHTML = "<button value='TVdelete' onclick='deleteRow(this)'>删除</button>";

				 
				alert('信息已经提交到表单里');
			}

			//清空
			function clearAll(){
				document.getElementById('name').value=null;
				document.getElementById('type').value=null;
				document.getElementById('guider').value=null;
				document.getElementById('players').value=null;
				document.getElementById('story').value=null;
			}

			//编辑
			function edit(editButton){
				var table = document.getElementById('TVlist');
				var index = editButton.parentNode.parentNode.rowIndex;

				var info = document.getElementsByName('tv');//表单标签栏，被填写部分
				var elements = ['picture', 'name', 'type', 'guider', 'players', 'story'];
				
				//图片部分
				console.log(table.rows[index].cells[0].src);

				//文字部分
				var i;
				for(i=0; i<info.length-1; i++){
					console.log(table.rows[index].cells[i].innerHTML);
					info[i].value = table.rows[index].cells[i+1].innerHTML;
					
				}
				console.log(table.rows[index].cells[i].innerHTML);
				info[i].innerHTML = table.rows[index].cells[i+1].innerHTML;

				deleteRow(editButton);
			}

			//非空检查
			function nullcheck(editbutton){
				var info = document.getElementsByName('tv');
				
				for(var i=0; i<info.length; i++){
					if(info[i].value == null || info[i].value == undefined || info[i].value == ''){
						console.log(info[i].value);
						alert('表单没有填写完整啊！');
						return false;
					}
				}

				return true;
			}
			
		</script>
	</head>
	<body>
		<p id='test'></p>
		<div id='TVtable'>
			<table id='TVlist' border=1px>
				<caption>
					<b>影视记录列表</b>
					<button id='addition'><a href='#TVedit'>增加</a></button>
				</caption>
				<tr>
					<th colspan='6'>影视信息</th>
					<th colspan='2'>操作</th>
				</tr>
				<tr>
					<th>海报</th>
					<th>影视名称</th>
					<th>影视类别</th>
					<th>导演</th>
					<th>主演</th>
					<th>剧情简介</th>
					
					<th>编辑</th>
					<th>删除</th>
				</tr>
				<tr>
					<td><img src='img/云南虫谷.jpg'></td>
					<td>云南虫谷</td>
					<td>悬疑、冒险</td>
					<td>费振翔</td>
					<td>潘粤明、张雨绮、姜超</td>
					<td>胡八一、Shirley杨、王胖子组成的探险三人组去往传闻中救人性命的雮尘珠成为了古滇国献王墓的随葬品，深入瘴疠之地探寻雮尘珠踪迹。</td>
					
					<td><button value='TVedit' onclick='edit(this);'><a href='#TVedit'>编辑</a></button></td>
					<td><button value='TVdelete' onclick='deleteRow(this)'>删除</button></td>
				</tr>
				<tr>
					<td><img src='img/龙岭迷窟.jpg' ></td>
					<td>龙岭迷窟</td>
					<td>悬疑、冒险</td>
					<td>费振翔</td>
					<td>潘粤明、张雨绮、姜超</td>
					<td>胡八一、王胖子和大金牙前往陕西古蓝县，无意掉入“龙岭迷窟”，遇到同样来找红斑根源的shirley杨，几人决心寻找雮尘珠。</td>
					
					<td><button value='TVedit' onclick='edit(this);'><a href='#TVedit'>编辑</a></button></td>
					<td><button value='TVdelete' onclick='deleteRow(this)'>删除</button></td>
				</tr>
				<tr>
					<td><img src='img/怒晴湘西.png' ></td>
					<td>怒晴湘西</td>
					<td>探险、悬疑</td>
					<td>费振翔</td>
					<td>潘粤明、高伟光、辛芷蕾</td>
					<td>民国年间，卸岭魁首陈玉楼，联手军阀罗老歪，入湘西瓶山探秘元墓。途遇搬山道人鹧鸪哨（高伟光饰），搬山历来不为财物，只为寻找解除族人诅咒的雮尘珠。</td>
					
					<td><button value='TVedit' onclick='edit(this)'><a href='#TVedit'>编辑</a></button></td>					
					<td><button value='TVdelete' onclick='deleteRow(this)'>删除</button></td>
				</tr>
			</table>
		</div>

		<div id='TVedit'>
			<form>
				<fieldset>
						<legend>影视剧信息</legend>
						<label>海报：</label><input type='file' name='file' id='fileUpload'>
						<label>影视名称：</label><input type='text' id='name' name='tv'/><br>
						<label>影视类别：</label><input type='text' id='type' name='tv'><br>
						<label>导演：</label><input type='text' id='guider' name='tv'/><br>
						<label>主演：</label><input type='text' id='players' name='tv'/><br>
						<label>剧情简介：</label><textarea rows='10' id='story' name='tv'>brief...</textarea><br>
						<div id='op'>
							<button type='button' onclick='if(nullcheck()) appendRow(2);'>确认提交</button>
							<button type='button'><a href='#TVtable'>回到表单</a></button>
						</div>
						<p id='brief'><b>注：</b><br>
							1. 如果需要编辑一个影视，那么默认先删除，修改成功后会添加在首行；<br>
							2. 在编辑一条记录时，海报需要重新上传。<br>
						</p>
				</fieldset>
			</form>
		</div>
	
		<p>存在着添加、回到表单的按钮跳转问题，建议在原网页上进行操作。<a href='index.html' target='_blank'>查看原网页</a></p>
	</body>
</html>
